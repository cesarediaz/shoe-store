<!doctype html>
<html>
  <head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

  </head>

  <body>
    <main>
      <div class="container">

        <h1>Inventory Stock</h1>

        <hr class="my-4">
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Store</th>
              <th scope="col">Model</th>
              <th scope="col">Qty</th>
              <th scope="col">Status</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="themed-grid-col justify-content-center text-center" id="store"></td>
              <td class="themed-grid-col justify-content-center text-center" id="model"></td>
              <td class="themed-grid-col justify-content-center text-center" id="quantity"></td>
              <td class="themed-grid-col justify-content-center text-center" id="stock"></td>
            </tr>
          </tbody>
        </table>

        <table class="table">
          <thead>
            <tr>
              <th scope="col">Where to send</th>
            </tr>
          </thead>
          <tbody id="houses_list">
          </tbody>
        </table>

      </div>
    </main>

    <script src='//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js'></script>

    <script src='http://localhost:9292/faye.js'></script>


    <script>
      function clean_destinations_list() {
        $('#houses_list').hide();
        $('#houses_list').empty();
      };

      function assign_store_values(data) {
        $('#store').text(data['store']);
        $('#model').text(data['model']);
        $('#quantity').text(data['quantity']);
        $('#stock').text(data['stock'].toUpperCase());
      };

      function styled_stock_message(stock) {
        let element = document.querySelector("#stock");

        element.style.color = "white"
        if (stock == 'minimum') {
          element.style.backgroundColor = "red"
        }
        if (stock == 'medium') {
          element.style.backgroundColor = "blue"
        }
        if (stock == 'high') {
          element.style.backgroundColor = "green"
        }
      };


      function houses_destination_list(houses) {
        var block_to_insert ;
        var container_block ;

        container_block = document.getElementById('houses_list');
        $('#houses_list').empty();

        if (houses != undefined && houses.length > 0) {
          houses.forEach(house => {
            block_to_insert = document.createElement( 'tr' );
            block_to_insert.innerHTML = house ;

            container_block.appendChild( block_to_insert );
          })
        } else {
          container_block.append( 'N\D' );
        }
        $('#houses_list').show();
      };

      $(function () {
        var faye = new Faye.Client('http://localhost:9292/faye');
        faye.subscribe('/messages/new', function (data) {
          console.log(data);
          clean_destinations_list();
          assign_store_values(data);
          houses_destination_list(data['houses']);
          styled_stock_message(data['stock']);
        });
      });
    </script>
  </body>
</html>
